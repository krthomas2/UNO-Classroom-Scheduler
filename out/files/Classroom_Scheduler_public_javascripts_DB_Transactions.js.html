<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Classroom_Scheduler\public\javascripts\DB_Transactions.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/DB_Transactions.html">DB_Transactions</a></li>
                                <li><a href="../classes/downloadSchedule.html">downloadSchedule</a></li>
                                <li><a href="../classes/editClass.html">editClass</a></li>
                                <li><a href="../classes/editGroup.html">editGroup</a></li>
                                <li><a href="../classes/editRoom.html">editRoom</a></li>
                                <li><a href="../classes/editSchedule.html">editSchedule</a></li>
                                <li><a href="../classes/generateSchedule.html">generateSchedule</a></li>
                                <li><a href="../classes/getCalendarInfo.html">getCalendarInfo</a></li>
                                <li><a href="../classes/index.js.html">index.js</a></li>
                                <li><a href="../classes/upload.html">upload</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/body-parser.html">body-parser</a></li>
                                <li><a href="../modules/cookie-parser.html">cookie-parser</a></li>
                                <li><a href="../modules/DB_Transactions.js.html">DB_Transactions.js</a></li>
                                <li><a href="../modules/express.html">express</a></li>
                                <li><a href="../modules/fs.html">fs</a></li>
                                <li><a href="../modules/index.js.html">index.js</a></li>
                                <li><a href="../modules/json2xls.html">json2xls</a></li>
                                <li><a href="../modules/morgan.html">morgan</a></li>
                                <li><a href="../modules/multer.html">multer</a></li>
                                <li><a href="../modules/path.html">path</a></li>
                                <li><a href="../modules/underscore.html">underscore</a></li>
                                <li><a href="../modules/xlsx.html">xlsx</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: Classroom_Scheduler\public\javascripts\DB_Transactions.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;
var assert = require(&#x27;assert&#x27;);
var ObjectId = require(&#x27;mongodb&#x27;).ObjectID;
var u = require(&#x27;underscore&#x27;);
//URL of database. Change if location of DB changes
var url = &#x27;mongodb://admin:Password2015@dbh46.mongolab.com:27467/meanapp&#x27;;
/* Example of secondary url string below */
//var url = &#x27;mongodb://admin:Password2015@ds029640.mongolab.com:29640/classroom_scheduler&#x27;;
var functions = module.exports = {

    /**
     * The database transactions for the application.
     * @class DB_Transactions
     *
     */
    /*insertClass
     * Created by: Nick Boeckman
     * Parameters:
     *   the information required for a class.
     * Returns: The id generated by the database.
     * Description:
     *   This function inserts one class into the database.*/
    /**
     * This function inserts one class into the database
     * @function insertClass
     * @param class_information
     * @returns The id generated by the database.
     */
	insertClass: function (class_information, callback){
		MongoClient.connect(url, function(err, db) {
			if (err) {
				console.log(err);
			}
			else {
                db.collection(&quot;Classes&quot;).insertOne(class_information, function (err, key) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback(key.ops[0]._id);
                    }
                });
            }
		});
	},
	/*getClass
     * Created by: Nick Boeckman
     * Parameters:
     *   OPTIONAL: The id of the class to retrieve from the database.
     * Returns: The class information found by the database.
     * Description:
     *   This function gets class information back from the database. Either it will get one class if a class id is
     *   specified, otherwise it returns all the classes in the database.*/
    /**
     * This function gets class information back from the database. Either it will get one class if a class id is
     * specified, otherwise it returns all the classes in the database.
     * @function getClass
     * @param class_id
     * OPTIONAL: The id of the class to retrieve from the database
     */
    getClass: function (class_id, callback){
        class_id = class_id || false;
        MongoClient.connect(url, function(err, db){
            if (err) {
                console.log(err);
            }
            else {
                if (class_id == false) {
                    db.collection(&quot;Classes&quot;).find().toArray(function(err, data){
                        callback(data);
                    });
                }
                else {
                    db.collection(&quot;Classes&quot;).find({_id: new ObjectId(class_id)}).toArray(function(err, data){
                        callback(data);
                    });
                }
            }
        });
    },
    /*getClassStart
    *Created by Kenneth and TJ
    */
    /**
     *@function getClassStart
     * @description
     * Sorts the Classes by start time.  Calculated with strings of 10:44:00 AM
     */
      getClassStart: function (class_id, callback){
        class_id = class_id || false;
        MongoClient.connect(url, function(err, db){
            if (err) {
                console.log(err);
            }
            else {
                if (class_id == false) {
                    db.collection(&quot;Classes&quot;).find().toArray(function(err, data){
         var sorted =    u._.sortBy(data,function(sortthis){
         var time = sortthis.Class_Time.Start.split(&quot; &quot;);//split class start time by time and AM or PM
         var timesep = time[0].split(&quot;:&quot;);//split time based on : markers
         var actualtime = (timesep[0]*3600);
            if ( time[1] === &#x27;PM&#x27; &amp;&amp; timesep[0] != 12){//check if AM or PM..if PM add 12 hours to the time
                actualtime = actualtime + (12 * 3600);
            }
            if(timesep[1] != &#x27;00&#x27;) {//check the minutes for start time
                actualtime = actualtime + (timesep[1] * 60);
            }
            if(timesep[2] != &#x27;00&#x27;){//If you really want to be anal with start times check if the seconds are moved
                actualtime = actualtime + (timesep[2]);
            }
                    return actualtime;
            });
                        callback(sorted);
                    });
                }
                else {
                    db.collection(&quot;Classes&quot;).find({_id: new ObjectId(class_id)}).toArray(function(err, data){
                        callback(data);
                    });
                }
            }
        });
    },

    /*updateClass
     * Created by: Nick Boeckman
     * Parameters:
     *   1) the id of the class to update.
     *   2) the information to be updated.
     * Returns: Nothing
     * Description:
     *   This function updates the specified class with the information provided.*/
    /**
     *   This function updates the specified class with the information provided.
     * @function updateClass
     * @param id
     * the id of the class to update.
     * @param class_information
     * the information to be updated.
     */
    updateClass: function (id, class_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err){
                console.log(err);
            }
            else {
                db.collection(&quot;Classes&quot;).updateOne({_id: new ObjectId(id)}, {$set: class_information}, function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback();
                    }
                });
            }
        });
    },
    /*removeClass
     * Created by: Nick Boeckman
     * Parameters:
     *   the id of the class to remove from the database.
     * Returns: None
     * Description:
     *   This function removes one class from the database, specifically the one for which the id was passed.*/
    /**
     *   This function removes one class from the database, specifically the one for which the id was passed.
     * @function removeClass
     * @param id
     * the id of the class to remove from the database.
     */
    removeClass: function (id, callback){
		MongoClient.connect(url, function(err, db) {
			if (err) {
				console.log(err);
			}
			else {
				db.collection(&quot;Classes&quot;, function (err, collection) {
					collection.removeOne({_id: new ObjectId(id)}, function(){
                        callback();
                    });
				});
			}
		});
	},
    /*insertClassroom
     * Created by: Nick Boeckman
     * Parameters:
     *   the information required for a classroom.
     * Returns: The id generated by the database.
     * Description:
     *   This function inserts one classroom into the database.*/
    /**
     * @function insertClassroom
     * @param room_information
     *   The information required for a classroom.
     * @description
     *   This function inserts one classroom into the database.
     */
    insertClassroom: function (room_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err) {
                console.log(err);
            }
            else {
                db.collection(&quot;Classrooms&quot;).insertOne(room_information, function (err, key) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback(key.ops[0]._id);
                    }
                });
            }
        });
    },
    /*getClassroom
     * Created by: Nick Boeckman
     * Parameters:
     *   OPTIONAL: The id of the classroom to retrieve from the database.
     * Returns: The classroom information found by the database.
     * Description:
     *   This function gets classroom information back from the database. Either it will get one classroom if a classroom id is
     *   specified, otherwise it returns all the classrooms in the database.*/
    /**
     * @function getClassroom
     * @param classroom_id
     */
    getClassroom: function (classroom_id, callback){  //Corresponds to classroom information for scehduler when id not provided.
        classroom_id = classroom_id || false;
        MongoClient.connect(url, function(err, db){
            if (err) {
                console.log(err);
            }
            else {
                if (classroom_id == false) {
                    db.collection(&quot;Classrooms&quot;).find().toArray(function(err, data){
                        callback(data);
                    });
                }
                else {
                    db.collection(&quot;Classrooms&quot;).find({_id: new ObjectId(classroom_id)}).toArray(function(err, data){
                        callback(data);
                    });
                }
            }
        });
	},
    /*getClassroomByNumber
     * Created by: Nick Boeckman
     * Parameters:
     *   The room number all the classes are located in.
     * Returns: The classroom information found by the database.
     * Description:
     *   This function gets classroom information back from the database, specifically the classrooms that are scheduled
     *   in the designated room.*/
    /**
     * @function getClassroomByNumber
     * @param room_number
     * The room number all the classes are located in.
     * @description
     *   This function gets classroom information back from the database, specifically the classrooms that are scheduled
     *   in the designated room.
     */
    getClassroomByNumber: function (room_number, callback){  //Corresponds to classroom information for scehduler when id not provided.
        MongoClient.connect(url, function(err, db){
            if (err) {
                console.log(err);
            }
            else {
                db.collection(&quot;Class_Schedule&quot;).find({Room_Number: room_number}).toArray(function(err, data){
                    callback(data);
                });
            }
        });
    },
    /*updateClassroom
     * Created by: Nick Boeckman
     * Parameters:
     *   1) the id of the classroom to update.
     *   2) the information to be updated.
     * Returns: Nothing
     * Description:
     *   This function updates the specified classroom with the information provided.*/
    /**
     * @function updateClassroom
     * @param id
     * the id of the classroom to update.
     * @param room_information
     * the information to be updated.
     * @description
     *   This function updates the specified classroom with the information provided.
     */
    updateClassroom: function (id, room_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err){
                console.log(err);
            }
            else {
                db.collection(&quot;Classrooms&quot;).updateOne({_id: new ObjectId(id)}, {$set: room_information}, function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback();
                    }
                });
            }
        });
    },
    /**
     * @function ValidateRoomAssign
     * @param id
     *  The class id value
     * @param class_information
     *   Information about the class
     * @constructor
     * @description
     * To check that the room was assigned.  Part of an alternate solution to scheduling.
     */
    ValidateRoomAssign: function (id, class_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err){
                console.log(err);
            }
            else {
                db.collection(&quot;Classes&quot;).updateOne({_id: new ObjectId(id)}, {$set: class_information}, function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback();
                    }
                });
            }
        });
    },
    /**
     * @function RunScheduler
     * @param id
     * @param room_information
     * @constructor
     * @description
     *  Part of the alternate scheduler solution.
     */

    RunScheduler: function (id, room_information, callback){
        var room_data = {
            &quot;Room_Number&quot;: room_information.Room_Number,
            &quot;Max_Capacity&quot;: room_information.Max_Capacity,
            &quot;Spec_Trait&quot;: room_information.Spec_Trait
        };
        MongoClient.connect(url, function(err, db) {
            if (err){
                console.log(err);
            }
            else {
                db.collection(&quot;Classrooms&quot;).updateOne({_id: new ObjectId(id)}, {$set: room_data}, function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback();
                    }
                });
            }
        });
    },
    /*AssignClass
     * Created by: Kenneth Thomas
     * Parameters:
     *   1) the id of the classroom to update.
     *   2) the room the class is being assigned.
     *   3) The unique course ID to be assigned
     *   4) The start positon to be filled
     *   5) The end position to be filled
     *   6) Callback of the function
     * Returns: Nothing
     * Description:
     *   This function takes a valid class assignment and adds it to the database*/
    /**
     * @function AssignClass
     * @param id
     * the id of the classroom to update.
     * @param room_information
     * the room the class is being assigned.
     * @param course_ID
     * The unique course ID to be assigned
     * @param start
     * The start positon to be filled
     * @param end
     * The end position to be filled
     * @param day
     * The days of the week of the class
     * @constructor
     * @Description
     *   This function takes a valid class assignment and adds it to the database
*/
    AssignClass: function (id, room_information, course_ID, start, end, day, callback) {
        while (start &lt; end) {
            switch (day) {
                case &quot;M&quot;:
                    console.log(room_information.M[start]);
                    room_information.M[start] = course_ID;
                    break;
                case &quot;T&quot;:
                    console.log(room_information.T[start]);
                    room_information.T[start] = course_ID;
                    break;
                case &quot;W&quot;:
                    console.log(room_information.W[start]);
                    room_information.W[start] = course_ID;
                    break;
                case &quot;H&quot;:
                    console.log(room_information.H[start]);
                    room_information.H[start] = course_ID;
                    break;
                case &quot;F&quot;:
                    console.log(room_information.F[start]);
                    room_information.F[start] = course_ID;
                    break;
                case &quot;S&quot;:
                    console.log(room_information.S[start]);
                    room_information.S[start] = course_ID;
                    break;
            }
            start++;
        }
    },

    /*RoomAvailability
     * Created by: Kenneth Thomas
     * Parameters:
     *   1) the id of the class to update.
     *   2) The room information of being checked
     *   3) The hour the classroom begins
     *   4) The minutes in the hour the class begins
     *   5) Whether the time is A:M or P.M
     *   6) The day on which the room is being requested.
     * Returns: Value of class assigned to a timeslot
     * Description:
     *   This function checks the beggining or end time to see if it has been taken for a room. A value of &quot;&quot; means it is free to assign, otherwise this room can&#x27;t go to that class*/
    /**
     * @function RoomAvailability
     * @param id
     * the id of the class to update.
     * @param room_information
     * The room information of being checked
     * @param hour
     * The hour the classroom begins
     * @param minute
     * The minutes in the hour the class begins
     * @param startAP
     * Whether the time is A:M or P.M
     * @param day
     * The day on which the room is being requested.
     * @returns {*}
     * Value of class assigned to a timeslot
     * @constructor
     * @description
     * Part of the alternate solution that proposed having availability times in the rooms database.
     */
    RoomAvailability: function (id, room_information, hour, minute, startAP, day) {
        var total = hour + &quot;:&quot; + minute + &quot;:&quot; + startAP;  //designates which time slot to check
        var position; //Designates which array slot a time corresponds to
        switch (total) {   //find array slot to check
            case &quot;7:0:A&quot;:
                position = 0;
                break;
            case &quot;7:15:A&quot;:
                position = 1;
                break;
            case &quot;7:30:A&quot;:
                position = 2;
                break;
            case &quot;7:45:A&quot;:
                position = 3;
                break;
            case &quot;8:0:A&quot;:
                position = 4;
                break;
            case &quot;8:15:A&quot;:
                position = 5;
                break;
            case &quot;8:30:A&quot;:
                position = 6;
                break;
            case &quot;8:45:A&quot;:
                position = 7;
                break;
            case &quot;9:0:A&quot;:
                position = 8;
                break;
            case &quot;9:15:A&quot;:
                position = 9;
                break;
            case &quot;9:30:A&quot;:
                position = 10;
                break;
            case &quot;9:45:A&quot;:
                position = 11;
                break;
            case &quot;10:0:A&quot;:
                position = 12;
                break;
            case &quot;10:15:A&quot;:
                position = 13;
                break;
            case &quot;10:30:A&quot;:
                position = 14;
                break;
            case &quot;10:45:A&quot;:
                position = 15;
            case &quot;11:0:A&quot;:
                position = 16;
                break;
            case &quot;11:15:A&quot;:
                position = 17;
                break;
            case &quot;11:30:A&quot;:
                position = 18;
                break;
            case &quot;11:45:A&quot;:
                position = 19;
                break;
            case &quot;12:0:P&quot;:
                position = 20;
                break;
            case &quot;12:15:P&quot;:
                position = 21;
                break;
            case &quot;12:30:P&quot;:
                position = 22;
                break;
            case &quot;12:45:P&quot;:
                position = 23;
                break;
            case &quot;1:0:P&quot;:
                position = 24;
                break;
            case &quot;1:15:P&quot;:
                position = 25;
                break;
            case &quot;1:30:P&quot;:
                position = 26;
                break;
            case &quot;1:45:P&quot;:
                position = 27;
                break;
            case &quot;2:0:P&quot;:
                position = 28;
                break;
            case &quot;2:15:P&quot;:
                position = 29;
                break;
            case &quot;2:30:P&quot;:
                position = 30;
                break;
            case &quot;2:45:P&quot;:
                position = 31;
                break;
            case &quot;3:0:P&quot;:
                position = 32;
                break;
            case &quot;3:15:P&quot;:
                position = 33;
                break;
            case &quot;3:30:P&quot;:
                position = 34;
                break;
            case &quot;3:45:P&quot;:
                position = 35;
            case &quot;4:0:P&quot;:
                position = 36;
                break;
            case &quot;4:15:P&quot;:
                position = 37;
                break;
            case &quot;4:30:P&quot;:
                position = 38;
                break;
            case &quot;4:45:P&quot;:
                position = 39;
                break;
            case &quot;5:0:P&quot;:
                position = 40;
                break;
            case &quot;5:15:P&quot;:
                position = 41;
                break;
            case &quot;5:30:P&quot;:
                position = 42;
                break;
            case &quot;5:45:P&quot;:
                position = 43;
                break;
            case &quot;6:0:P&quot;:
                position = 44;
                break;
            case &quot;6:15:P&quot;:
                position = 45;
                break;
            case &quot;6:30:P&quot;:
                position = 46;
                break;
            case &quot;6:45:P&quot;:
                position = 47;
                break;
            case &quot;7:0:P&quot;:
                position = 48;
                break;
            case &quot;7:15:P&quot;:
                position = 49;
                break;
            case &quot;7:30:P&quot;:
                position = 50;
                break;
            case &quot;7:45:P&quot;:
                position = 51;
                break;
            case &quot;8:0:P&quot;:
                position = 52;
                break;
            case &quot;8:15:P&quot;:
                position = 53;
                break;
            case &quot;8:30:P&quot;:
                position = 54;
                break;
            case &quot;8:45:P&quot;:
                position = 55;
                break;
            case &quot;9:0:P&quot;:
                position = 56;
                break;
            case &quot;9:15:P&quot;:
                position = 57;
                break;
            case &quot;9:30:P&quot;:
                position = 58;
                break;
            case &quot;9:45:P&quot;:
                position = 59;
                break;
            default:
                return -1;  //invalid entry entered
                break;
        }
        switch (day) {
            case &quot;M&quot;:
                console.log(room_information.M[position]);
                if (room_information.M[position] == &quot;&quot;)
                return position;
                else
                return -1  //Already Assigned
                break;
            case &quot;T&quot;:
                console.log(room_information.T[position]);
                if (room_information.T[position] == &quot;&quot;)
                    return position;
                else
                    return -1  //Already Assigned
                break;
            case &quot;W&quot;:
                console.log(room_information.W[position]);
                if (room_information.W[position] == &quot;&quot;)
                    return position;
                else
                    return -1  //Already Assigned
                break;
            case &quot;H&quot;:
                console.log(room_information.H[position]);
                if (room_information.H[position] == &quot;&quot;)
                    return position;
                else
                    return -1  //Already Assigned
                break;
            case &quot;F&quot;:
                console.log(room_information.F[position]);
                if (room_information.F[position] == &quot;&quot;)
                    return position;
                else
                    return -1  //Already Assigned
                break;
            case &quot;S&quot;:
                console.log(room_information.S[position]);
                if (room_information.S[position] == &quot;&quot;)
                    return position;
                else
                    return -1  //Already Assigned
                break;
        }
    },
    /**
     * @function updateClassroomAssigns
     * @param id
     *  Classroom id.
     * @param room_information
     *  Information of the room to update.
     *  @description
     *  Updates the classrooms to have the initial value of &quot;&quot;...part of alternate scheduler...not currently active.
     */
updateClassroomAssigns: function (id, room_information, callback){
        var room_data = {
            &quot;Room_Number&quot;: room_information.Room_Number,
            &quot;Max_Capacity&quot;: room_information.Max_Capacity,
            &quot;Spec_Trait&quot;: room_information.Spec_Trait,
            &quot;M&quot;: [&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;],
            &quot;T&quot;: [&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;],
            &quot;W&quot;: [&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;],
            &quot;H&quot;: [&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;],
            &quot;F&quot;: [&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;],
            &quot;S&quot;: [&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;]
        };
        MongoClient.connect(url, function(err, db) {
            if (err){
                console.log(err);
            }
            else {
                db.collection(&quot;Classrooms&quot;).updateOne({_id: new ObjectId(id)}, {$set: room_data}, function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback();
                    }
                });
            }
        });
    },
    /*removeClassroom
     * Created by: Nick Boeckman
     * Parameters:
     *   the id of the classroom to remove from the database.
     * Returns: None
     * Description:
     *   This function removes one classroom from the database, specifically the one for which the id was passed.*/
    /**
     * @function removeClassroom
     * @param id
     *   the id of the classroom to remove from the database.
     * @description
     *   This function removes one classroom from the database, specifically the one for which the id was passed.
     */
    removeClassroom: function (id, callback){
        MongoClient.connect(url, function(err, db) {
            if (err) {
                console.log(err);
            }
            else {
                db.collection(&quot;Classrooms&quot;, function (err, collection) {
                    collection.removeOne({_id: new ObjectId(id)}, function () {
                        callback();
                    });
                });
            }
        });
    },
    /*insertClassGroup
     * Created by: Nick Boeckman
     * Parameters:
     *   the information required for a class grouping.
     * Returns: The id generated by the database.
     * Description:
     *   This function inserts one class grouping into the database.*/
    /**
     * @function insertClassGroup
     * @param group_information
     *   the information required for a class grouping.
     * @description
     *   This function inserts one class grouping into the database.
     */
    insertClassGroup: function (group_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err) {
                console.log(err);
            }
            else {
                db.collection(&quot;Class_Groups&quot;).insertOne(group_information, function (err, key) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback(key.ops[0]._id);
                    }
                });
            }
        });
    },
    /*getClassGroup
     * Created by: Nick Boeckman
     * Parameters:
     *   OPTIONAL: The id of the class grouping to retrieve from the database.
     * Returns: The class grouping information found by the database.
     * Description:
     *   This function gets class grouping information back from the database. Either it will get one group if a group id is
     *   specified, otherwise it returns all the groups in the database.*/
    /**
     * @function getClassGroup
     * @param group_id
     *   OPTIONAL: The id of the class grouping to retrieve from the database.
     * @description
     * This function gets class grouping information back from the database. Either it will get one group if a group id is
     * specified, otherwise it returns all the groups in the database.
    */
    getClassGroup: function (group_id, callback){
        group_id = group_id || false;
        MongoClient.connect(url, function(err, db){
            if (err) {
                console.log(err);
            }
            else {
                if (group_id == false) {
                    db.collection(&quot;Class_Groups&quot;).find().toArray(function(err, data){
                        callback(data);
                    });
                }
                else {
                    db.collection(&quot;Class_Groups&quot;).find({_id: new ObjectId(group_id)}).toArray(function(err, data){
                        callback(data);
                    });
                }
            }
        });
	},

    /*updateClassGroup
     * Created by: Nick Boeckman
     * Parameters:
     *   1) the id of the class group to update.
     *   2) the information to be updated.
     * Returns: Nothing
     * Description:
     *   This function updates the specified class grouping with the information provided.*/
    /**
     * @function updateClassGroups
     * @param id
     * the id of the class group to update.
     * @param group_information
     * the information to be updated.
     * @description
     *   This function updates the specified class grouping with the information provided.
     */
    updateClassGroups: function (id, group_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err){
                console.log(err);
            }
            else {
                db.collection(&quot;Class_Groups&quot;).updateOne({_id: new ObjectId(id)}, {$set: group_information}, function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback();
                    }
                });
            }
        });
    },
    /*removeClassGroup
     * Created by: Nick Boeckman
     * Parameters:
     *   the id of the class grouping to remove from the database.
     * Returns: None
     * Description:
     *   This function removes one class grouping from the database, specifically the one for which the id was passed.*/
    /**
     * @function removeClassGroup
     * @param id
     *   the id of the class grouping to remove from the database.
     * @description
     *This function removes one class grouping from the database, specifically the one for which the id was passed.
     */
    removeClassGroup: function (id, callback){
        MongoClient.connect(url, function(err, db) {
            if (err) {
                console.log(err);
            }
            else {
                db.collection(&quot;Class_Groups&quot;, function (err, collection) {
                    collection.removeOne({_id: new ObjectId(id)}, function () {
                        callback();
                    });
                });
            }
        });
    },
    /*insertSched
     * Created by: Nick Boeckman
     * Parameters:
     *   the information required to schedule a room.
     * Returns: The id generated by the database.
     * Description:
     *   This function inserts one scheduled class along with its room information into the database.*/
    /**
     * @function insertSched
     * @param schedule_information
     * @returns
     * The id generated by the database.
     * @description
     *   This function inserts one scheduled class along with its room information into the database.
     */

    insertSched: function (schedule_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err) {
                console.log(err);
            }
            else {
                db.collection(&quot;Class_Schedule&quot;).insertMany(u._.compact(schedule_information), function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {

                    }
                });
            }
        });
    },
    /*getSchedule
     * Created by: Nick Boeckman
     * Parameters:
     *   OPTIONAL: The id of the schedule information to retrieve from the database.
     * Returns: The schedule information found by the database.
     * Description:
     *   This function gets scheduling information back from the database. Either it will get one scheduled class if an id is
     *   specified, otherwise it returns all the schedule information in the database.*/
    /**
     * @function getSchedule
     * @param sched_id
     *  Optional: The schedule id
     * @description
     * This function gets scheduling information back from the database. Either it will get one scheduled class if an id is
     * specified, otherwise it returns all the schedule information in the database.
     */
    getSchedule: function (sched_id, callback){
        sched_id = sched_id || false;
        MongoClient.connect(url, function(err, db){
            if (err) {
                console.log(err);
            }
            else {
                if (sched_id == false) {
                    db.collection(&quot;Class_Schedule&quot;).find().toArray(function(err, data){
                        callback(data);
                    });
                }
                else {
                    db.collection(&quot;Class_Schedule&quot;).find({_id: new ObjectId(sched_id)}).toArray(function(err, data){
                        callback(data);
                    });
                }
            }
        });
	},
    /**
     * @function getScheduleByRoom
     * @param sched_id
     *  Unique schedule identifier
     * @param room_number
     *  Room number in question
     *  @description
     *  Gets data from schedule table for a specific room.
     */
    getScheduleByRoom: function (sched_id, room_number, callback){
        sched_id = sched_id || false;
        MongoClient.connect(url, function(err, db){
            if (err) {
                console.log(err);
            }
            else {
                if (sched_id == false) {
                    db.collection(&quot;Class_Schedule&quot;).find().toArray(function(err, data){
                        callback(data);
                    });
                }
                else {
                    db.collection(&quot;Class_Schedule&quot;).find({Room_Number: room_number}).toArray(function(err, data){
                        callback(data);
                    });
                }
            }
        });
    },
    /*updateSched
     * Created by: Nick Boeckman
     * Parameters:
     *   1) the id of the scheduled class to update.
     *   2) the information to be updated.
     * Returns: Nothing
     * Description:
     *   This function updates the specified schedule information with the information provided.*/
    /**
     * @function updateSched
     * @param id
     * the id of the scheduled class to update.
     * @param sched_information
     * the information to be updated.
     * @description callback
     *   This function updates the specified schedule information with the information provided.
     */
    updateSched: function (id, sched_information, callback){
        MongoClient.connect(url, function(err, db) {
            if (err){
                console.log(err);
            }
            else {
                db.collection(&quot;Classes&quot;).updateOne({_id: new ObjectId(id)}, {$set: {Room_Assigned: sched_information.Room_Assigned}},{upsert:true}, function (err) {
                    if (err) {
                        console.log(err);
                    }
                    else {
                        callback();
                    }
                });
            }
        });
	},
    /*removeSched
     * Created by: Nick Boeckman
     * Parameters:
     *   the id of the scheduled information to remove from the database.
     * Returns: None
     * Description:
     *   This function removes one scheduled class room combination from the database, specifically the one for which the id was passed.*/
    /**
     * @function removeSched
     * @param id
     *   the id of the scheduled information to remove from the database.
     * @description
     *   This function removes one scheduled class room combination from the database, specifically the one for which the id was passed.
     */
    removeSched: function (id, callback){
		MongoClient.connect(url, function(err, db) {
				if (err) {
					console.log(err);
				}
				else {
                    db.collection(&quot;Class_Schedule&quot;, function (err, collection) {
                        collection.removeOne({_id: new ObjectId(id)}, function () {
                            callback();
                        });
                    });
                }
		});
	},
    /*clearScheduler
     * Created by: Nick Boeckman
     * Parameters: None
     * Returns: None
     * Description:
     *   This function clears all the information from the database, with the exception of room information.*/
    /**
     * @function ClearScheduler
     * @description
     * Purges the database of everything except classrooms.
     */
    clearScheduler: function(callback){
        MongoClient.connect(url, function(err, db) {
            if (err) {
                console.log(err);
            }
            else {
                db.collection(&quot;Classes&quot;).remove({});
                db.collection(&quot;Class_Groups&quot;).remove({});
                db.collection(&quot;Class_Schedule&quot;).remove({});
                callback();
            }
        });
    },
/* clearSchedule
* Created by: TJ
* Parameters: None
* Returns: None
* Description:
*   This function clears all the information from the schedule, leaving the other tables alone
*/
    /**
     * @function clearSchedule
     * @description
     * Clears only the schedule table.
     */
    clearSchedule: function(callback){
    MongoClient.connect(url, function(err, db) {
        if (err) {
            console.log(err);
        }
        else {
            db.collection(&quot;Class_Schedule&quot;).remove({});
            callback();
        }
    });
},
    /*Excel Import*/
	importExcelToDb: importExcelToDb
}
/*importExcelToDB
 * Created by: Nick Boeckman
 * Parameters:
 *    Json object listing all the class information from the excel spreadsheet.
 * Returns: None
 * Description:
 *   This function is designed to help get the information imported from the uploaded excel spreadsheet and adds it all
 *   to the database. This function also creates the class grouping information necessary to combine all the classes.*/
/**
 * @function importExcelToDb
 * @param put
 *  An array of classdata needing a wrapper to make an object.
 * @description
 *  Takes and automates inserting data/groups when using the excel upload option.
 */
function importExcelToDb(put) {
    var dbAdditions = [];

    for (var x = 0; x &lt; put.length; x++) {//iterating through courses
        //This is the array of data needing an insert into the classes table.
        dbAdditions[x] = {
            &quot;Subject&quot;: put[x][&quot;Subject&quot;],
            &quot;Course_ID&quot;: put[x][&quot;Catalog&quot;],
            &quot;Section_ID&quot;: put[x][&quot;Section&quot;],
            &quot;Class_ID&quot;: put[x][&quot;Class Nbr&quot;],
            &quot;Course_Title&quot;: put[x][&quot;Title&quot;],
            &quot;Lecture_Type&quot;: put[x][&quot;Component&quot;],
            &quot;Class_Time&quot;: {
                &quot;Start&quot;: put[x][&quot;Mtg Start&quot;],
                &quot;End&quot;: put[x][&quot;Mtg End&quot;],
                &quot;Days&quot;: put[x][&quot;Pat&quot;]
            },
            &quot;Instructor&quot;: {
                First_Name: put[x][&quot;First Name&quot;],
                Last_Name: put[x][&quot;Last&quot;]
            },
            &quot;Class_Capacity&quot;: put[x][&quot;Cap Enrl&quot;],
            &quot;Description&quot;: put[x][&quot;Descr&quot;],
            &quot;Acad_Group&quot;: put[x][&quot;Acad Group&quot;],
            &quot;Tot_Enrl&quot;: put[x][&quot;Tot Enrl&quot;],
            &quot;Start_Date&quot;: put[x][&quot;Start Date&quot;],
            &quot;End_Date&quot;: put[x][&quot;End Date&quot;],
            &quot;Session&quot;: put[x][&quot;Session&quot;],
            &quot;Location&quot;: put[x][&quot;Location&quot;],
            &quot;Mode&quot;: put[x][&quot;Mode&quot;],
            &quot;CrsAtr_Val&quot;: put[x][&quot;CrsAtr_Val&quot;]
        };
    }
    MongoClient.connect(url, function (err, db) {
        if (err) {
            console.log(err);
        }
        else {
            db.collection(&quot;Classes&quot;).insertMany(dbAdditions, function (err) {
                if (err) {
                    console.log(err);
                }
                else { //Ok, we now have all the classes into the database, so we need to do the same thing with the class groups,
                 //because apparently the idea of making the groups decided through human interaction, like was suggested,
                 //isn&#x27;t good enough for this project, even though there isn&#x27;t any intuitive way to solve this problem.*/
                    var groups = [];
                    var group_ids = [];
                    for (var x = 0; x &lt; dbAdditions.length; x++) {
                        if (err) {
                            console.log(err);
                        }
                        else {
                                var found = false;
                                for (var y = 0; y &lt; groups.length; y++) {
                                    //We have to check the parameters down below to test if the two classes are in the same group.
                                    if (groups[y][&quot;First_Name&quot;].valueOf() == dbAdditions[x][&quot;Instructor&quot;][&quot;First_Name&quot;].valueOf() &amp;&amp;
                                        groups[y][&quot;Last_Name&quot;].valueOf() == dbAdditions[x][&quot;Instructor&quot;][&quot;Last_Name&quot;].valueOf() &amp;&amp;
                                        groups[y][&quot;Pat&quot;].valueOf() == dbAdditions[x][&quot;Class_Time&quot;][&quot;Days&quot;].valueOf() &amp;&amp;
                                        groups[y][&quot;Start&quot;].valueOf() == dbAdditions[x][&quot;Class_Time&quot;][&quot;Start&quot;].valueOf()) {
                                        try {
                                            //Try adding this new object to the group_ids array.
                                            group_ids[y][&quot;id&quot; + Object.keys(group_ids[y]).length] = dbAdditions[x][&quot;_id&quot;];
                                            var cap = parseInt(group_ids[y].Class_Capacity);
                                            var cap2 =parseInt(dbAdditions[x].Class_Capacity);
                                            var cap = cap + cap2;
                                            group_ids[y][&quot;Class_Capacity&quot;] = cap; //get the combined cap for the group
                                        }
                                        catch(err){
                                            console.log(err);
                                        }
                                        found = true;
                                    }
                                }
                                if (!found) {
                                    groups[groups.length] = { //Add this as a new group at a new index.
                                        &quot;First_Name&quot;: dbAdditions[x][&quot;Instructor&quot;][&quot;First_Name&quot;],
                                        &quot;Last_Name&quot;: dbAdditions[x][&quot;Instructor&quot;][&quot;Last_Name&quot;],
                                        &quot;Pat&quot;: dbAdditions[x][&quot;Class_Time&quot;][&quot;Days&quot;],
                                        &quot;Start&quot;: dbAdditions[x][&quot;Class_Time&quot;][&quot;Start&quot;]
                                    };
                                    try {
                                        group_ids[groups.length] = new Object(); //Create a new object in the group_ids table.
                                        group_ids[groups.length][&quot;Course_Title&quot;] = dbAdditions[x].Course_Title;//Data about the group
                                        group_ids[groups.length][&quot;Instructor&quot;] = dbAdditions[x].Instructor.First_Name +&quot; &quot;+ dbAdditions[x].Instructor.Last_Name;
                                        group_ids[groups.length][&quot;Start&quot;] = dbAdditions[x].Class_Time.Start;
                                        group_ids[groups.length][&quot;End&quot;] = dbAdditions[x].Class_Time.End;
                                        group_ids[groups.length][&quot;Days&quot;] = dbAdditions[x].Class_Time.Days;
                                        group_ids[groups.length][&quot;Class_Capacity&quot;] = dbAdditions[x].Class_Capacity;
                                        group_ids[groups.length][&quot;id0&quot;] = dbAdditions[x][&quot;_id&quot;];  //Add this as the first new id in that table.
                                    }
                                    catch(err){
                                        console.log(err);
                                    }
                                }
                        }
                    }
                    MongoClient.connect(url, function (err, db) {
                        if (err) {
                            console.log(err);
                        }
                        else {
                            db.collection(&quot;Class_Groups&quot;).insertMany(u._.compact(group_ids), function (err) {
                                if (err) {
                                    console.log(err);
                                }
                            });
                        }
                    });
                }
            });
        }
    });
}


    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
